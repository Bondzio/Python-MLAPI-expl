import sqlite3
import random
import pandas as pd
from math import sqrt

# to run on Kaggle
sql_conn = sqlite3.connect('../input/database.sqlite')
# to run localy
#sql_conn = sqlite3.connect('database.sqlite')

#copy the list output from extract test data
testAuthors = ['---_-o-', '---__--', '---annon---', '---david', '---fuckyou---', '---sniff---', '--23---', '--4-8-15-16-23-42', '--404--', '--Caius--', '--Danny', '--FrenchyBoy--', '--Greg--', '--Kai--', '--Lust--', '--MxM--', '--Petrichor--', '--Ping--', '--Poot--', '--STACK--', '--Satan--', '--Sharpe--', '--Sigma--', '--TERRORIST--', '--TheDoctor--', '--Void--', '--_--_--_--_--_--_', '--caddish--', '--cheese--', '--comadose', '--cunt', '--fap--', '--focus--', '--geode', '--hundy', '--hypnos--', '--majin--', '--o', '--o__O--', '--recursive', '--seaker--', '--shera--', '--smokeandmirrors--', '--somethingnew--', '--theriverstyx--', '--tomo', '--treandoge--', '--u-s-e-r-n-a-m-e--', '-100-Broken-Windows-', '-127', '-13-', '-14k-', '-1683-', '-1921-', '-1_1-', '-2vsU-', '-33rpm', '-3rdperson', '-4-8-15-16-23-42-', '-500-', '-5FDP-', '-5m', '-6-6-6-', '-73-', '-888-', '-A1', '-AC-', '-ADEPT-', '-APA-', '-ATLien-', '-Abnormal-', '-Acerin', '-AcodeX', '-Aeryn-', '-Afrodisiac-', '-AgentMichaelScarn', '-Ahab-', '-Ai', '-Albus-', '-Alecat', '-Andar-', '-Anguscr4p-', '-Argih', '-Arkennon', '-ArthurDent-', '-Aslan-', '-Avacyn', '-Avatar-Korra-', '-Axiom-', '-Axon-', '-Azax-', '-AznNinja-', '-BEEFSQUATCH', '-BLAM', '-BMP-', '-BW-', '-BabbaBooey-', '-Babo97-', '-Bad-Mother-fucker-', '-Badger2-', '-Baker', '-Bana', '-Bashamo', '-Bathtub-Gin-', '-BearFucker-', '-Beren-', '-Best_Name_Ever-', '-Betch-', '-Beth-', '-BeyondWonderland-', '-Bi-Polar-Bear-', '-Big_Test_Icicles-', '-Bingo-', '-BipBapBam-', '-Blaka-', '-Blasko', '-BlitzN9ne', '-BlueJayway-', '-Borfo-', '-BushWacker-', '-Butt-Fumble-', '-C20H25N3O-', '-CA-', '-CONTRABAND-', '-CORNADO-', '-CORRECT-MY-GRAMMAR-', '-C_R_E_A_M-', '-Caesar', '-Canonical-', '-CassaNova-', '-Cerberus', '-Champloo-', '-CharlieFoxtrot-', '-Chinchillax-', '-ChowanChillin-', '-ClarkNova-', '-Clayton_Bigsby-', '-Cliche-', '-Col-', '-Colby', '-Coop-', '-Covariance', '-Crazy-World-', '-Crumb-', '-Cubix', '-Cubone-', '-Cwap', '-Cyy', '-DD', '-DDD-', '-DEMOCRACY-', '-Daetrax-', '-Damien-', '-Daniel', '-DannyDevito-', '-Dapper-Dan-', '-Dappertron-', '-Dargs', '-DarkNeko', '-DarkStar-', '-Dark_Link-', '-Davo', '-Degaussed-', '-Derelict-', '-Desultor', '-Deuce-', '-Diatribe_6', '-Dillon-', '-DinosaurX-', '-DisobedientAvocado-', '-Dissent', '-Domino-', '-DonQuixote-', '-DonnieDarko-', '-DontCrushMeFatty-', '-Doomcrow-', '-Dr_Strangelove-', '-Dragin-', '-DrumDad', '-Duck-', '-Dys-', '-EViL-KoNCEPTz-', '-EW-', '-EasterEggs', '-ElectricKoolAid', '-Emberstorm', '-Energy', '-Enkara-', '-EverydayImRustlin-', '-Exocoetidae-', '-Exstasy', '-FC-', '-Fake', '-Feartjeh', '-FeistyRabbitSauce-', '-Fender-', '-Fennekin-', '-FishPants', '-Flossie-', '-Fluffmallow-', '-Fluffy', '-FluffyBunny', '-Frank', '-FuckMe-', '-Gabe-', '-Gabria', '-Gemeni', '-GheeButtersnaps-', '-GirthControl-', '-Glitterous-', '-GoatNamedFelicia-', '-Googlrr', '-GreenStar-', '-H-E-L-I-X-', '-H__H-', '-HarryManback-', '-Hastis-', '-Hawky-', '-Hegemon-', '-HelenOfTroy-', '-Hellfire-', '-High-C', '-HisDivineShadow-', '-Holmer13-', '-Hoopin-', '-Horhay-', '-HumorousWombat-', '-Hydrax-', '-IAmEvil', '-IHaveNoGoddamnClue-', '-ILikePie-', '-IZ-', '-I_AM_GROOT-', '-Icaria-', '-Ihatefatpeople-', '-IllegalPill-', '-Imserious-', '-Indeed-', '-Influenza', '-InigoMontoya', '-IntoEternity-', '-IntoTheVoid-', '-IoI-', '-IrishGunnerHD-', '-IronBorne-', '-J-P-', '-JAC', '-JDubs-', '-JI', '-JS-', '-J_K_Fry', '-JaM--', '-Jaime-Lannister-', '-JamesAsner-', '-Japan', '-Jeebis-', '-Jeremiad-', '-Jim-Lahey', '-JimmyRustles', '-Jings-', '-Jinxy-', '-Jive-Turkey-', '-Joeta-', '-Joey-Wheeler-', '-Johnny-', '-Josh', '-JuSt_My_LuCk', '-JustShy-', '-Just_Talk-', '-KILR0Y-', '-KarmaSlut', '-Karmavore', '-Kato', '-Kermit-', '-Ketracel-White', '-Kevin-', '-KhmerBear-', '-Kilgore_Trout-', '-Kim-JongUn-', '-Kimi-', '-Knul-', '-Kryptic-', '-Kuroh-', '-L3G10N-', '-LEMONGRAB-', '-LS-', '-Legendary-', '-Lemoncola-', '-Lemur', '-Levi', '-Lo_Mein_Kampf-', '-Lolrax-', '-MD-', '-MK-Systems-', '-MOPPET-', '-MPG13-', '-MS-94-', '-MSP-', '-MURS-', '-MVP', '-M_K-', '-M_W', '-MacCoy', '-MadameOvaries-', '-Madi-', '-Mahn', '-Manananggal-', '-MangoDown', '-MangoDown-', '-MarcusD-', '-MarkTwang-', '-Mars', '-Massachoosite', '-Master-Builder-', '-Mattwi', '-McLovin', '-Megain-', '-Megrim-', '-MelonLord-', '-Metalithic-', '-Mikee', '-Mirgeaux-', '-Misla-', '-Miyata', '-Mockingbird', '-Moniker-', '-Monkey', '-Moonchild-', '-Mountain-King-', '-Mr-Papaya', '-MuffinTown-', '-MusicAndStuff', '-MyP0rnAccount-', '-MyUsername-', '-My_Other_Account-', '-NAhL-', '-NS-', '-Napoleonidas-', '-Narble-', '-Nature', '-NatureBoy-', '-Navajo-', '-NegativeZero-', '-Nii-', '-Nikolaus-', '-No-One', '-Norb', '-Nortrom-', '-Novowels', '-OMGZOMBIES-', '-OPTHOMASPRIME-', '-OP_pls-', '-Oberlander', '-Obito-', '-Oc-', '-Oggy-', '-Oizys', '-Olek', '-OptimusPrimate-', '-OrangeLightning4', '-Orion-', '-Other_Barry-', '-PM_ME_YOUR_GENITALS', '-PSTV-ENRG-', '-PTM-', '-Pao', '-PaperbackWriter-', '-ParticleMan-', '-Pasha-', '-Pelvis-', '-PeterParker-', '-Pharetra-', '-PiPo-', '-Pin_Cushion-', '-Pixelate', '-Pm_Me_Your_Pm-', '-Poe-', '-PokeMaster', '-Polyphony-', '-PotatoMan-', '-Powdered-Toast-', '-Princeps-', '-Psychox', '-PurpleStain', '-R3DF0X', '-RAS', '-RNG-', '-RYknow', '-Ragnar', '-Ran', '-Rand-', '-Randi-', '-RandomPoem-', '-RandyMarsh', '-Rayko-', '-RdV-', '-Red_Forman-', '-Rednal-', '-Reggin-', '-Renton-', '-Replicated', '-Resist-', '-Richard', '-Riko', '-RiskManagement-', '-Rivox-', '-Rizhiy-', '-Rob', '-Rum-Ham-', '-Runaway', '-Runki-', '-Ryu-', '-SD-', '-SPIRITUAL-GANGSTER-', '-SPN', '-STEW-', '-STFU_DONNY-', '-SagaQ-', '-Saggio-', '-Sah-', '-Sai-', '-Saki', '-Sam-R-', '-ScubaSteve', '-Senjougahara-', '-Seraph', '-Shadowphoenix-', '-ShaiHulud', '-Sharad-', '-Sharles-', '-Shenanigans', '-Shirley-', '-ShootMeNow-', '-Shooter_McGavin-', '-Simba', '-SingularSoul-', '-Skaboomatude', '-Skir-', '-Sloth', '-Slunk', '-Slutlord-Fascist-', '-Smacky-the-Frog-', '-SnowMan-', '-SoItGoes', '-SofaKing-', '-SowLo-', '-SpaceGh0st-', '-Spider-Man-', '-StevieJanowski-', '-StopRefresh-', '-Strider', '-StripMyMind-', '-Stupendous-Man-', '-Sty-', '-SubZer000z', '-SuicideThrowaway-', '-Sunshiner-', '-SwedishGuy-', '-Swifty', '-Synergy-', '-Sythen-', '-THE_BIG_BOSS-', '-TaborlinTheGreat-', '-Teekey-', '-Tellos-', '-Tendo-', '-Terriermon-', '-Tesserex-', '-ThatGuyHere', '-ThatGuyOnReddit', '-TheCabbageMerchant-', '-TheDevilsAssistant-', '-TheDoctor', '-TheDude', '-TheLethalAlphX-', '-TheMAXX-', '-TheNinthDoctor-', '-TheRowAway-', '-TheTechGuy-', '-TheWaddleWaddle-', '-TheWanderer-', '-TheWindBlows-', '-TheWrongThingToSay-', '-The_Blazer-', '-Themis-', '-Thomas_Jefferson-', '-ThrowawayEMT-', '-Thunderbear-', '-TinMan-', '-ToTheWorld-', '-Token', '-Tom-', '-Tommy', '-Toshi', '-Trans-Am-', '-Travis-', '-Tree', '-Trips', '-Umbra-', '-Umbrakinesis', '-Unknown_', '-Unparalleled-', '-Unproductive-', '-UrsaMajor-', '-Venser-', '-Vertex-', '-ViceGrip-', '-Volumes_', '-WISCONSIN-', '-WPD-', '-WeepingAngel-', '-WhenTheyCry-', '-Wicked3Studios-', '-Wiggles-', '-Wildboyz-', '-XDerekX-', '-XIII-', '-Yngin-', '-YouWontLikeIt', '-ZOU-', '-Zacast-', '-Zenith-', '-Zonz-', '-Zoomacroom-', '-_--___-_--_--___--_', '-_-BanditGirl-_-', '-_-C21H30O2-_-', '-_-Edit_Deleted-_-', '-_-HammockLand-_-', '-_-Zach-_-', '-_-_-_-__-_-_-_-', '-_-__---__-', '-_-__-_-_-__-_-', '-_-recalculating-_-', '-_Dan_-', '-_ICANTREAD-_', '-_Jim_-', '-_Odd_-', '-_Trashboat', '-__---____-----', '-__-_', '-___-___-', '-_l_-l_-_-_', '-_smalls_-', '-adaptive', '-aes', '-aether-', '-aimless-', '-airborne-', '-anne-marie-', '-arKK', '-atheos', '-aurelius', '-bananabread-', '-bicurious-', '-blah', '-blank', '-blue-eyes-', '-bluebat-', '-bojangles', '-bolo-', '-bonesaw-', '-bornlivedie-', '-buz', '-c0de-', '-citylights', '-cookie-monsta-', '-crave', '-cupcake', '-cutestofborg-', '-cyan', '-danceinthegraveyard', '-dead_slender-', '-del2phi', '-delete-', '-deteled-', '-devonjones', '-dingus', '-do_not_resuscitate-', '-dolantello-', '-dont-believe-me', '-doughboy', '-drbadass-', '-drunkenmaster', '-dudeomfgstfux-', '-dujek-', '-dusk-', '-eagle73', '-earthmover', '-ellipsys-', '-eltopo', '-entropy-', '-er', '-error37', '-fd-', '-ferrocactus', '-fluffs', '-forbidden', '-fuck-off-loser-', '-fuckyouthatswhy-', '-generic-username-', '-gh0stRush-', '-ghostinthemachine-', '-goocher-', '-good-', '-guanaco', '-gurgle-', '-halcyon', '-haven', '-heathcliffe-', '-hh', '-highpriestessoftea-', '-hondo-', '-honest', '-hummingbird-', '-hx', '-iNfluence', '-iambatman-', '-idk', '-ilikesnow-', '-insert_user-', '-insignificant-', '-internets', '-intrigued', '-ipseDixit-', '-iusedtobecool', '-izac-', '-jabberwock', '-jackschitt-', '-jub-', '-juice', '-jz', '-katekiko', '-kazken-', '-kellam-', '-kenny-', '-kenobi-', '-klassy-', '-kodoku-', '-kunai', '-kvothe-', '-kwee-', '-l0tus-', '-lTNA', '-landtank', '-littlefang-', '-lll-------lll-', '-lumpinator-', '-magilla-', '-main', '-maker', '-malacath-', '-malloc', '-malpa-', '-manny_calavera-', '-mattybatty-', '-mb-', '-mbartlett', '-mickomoo-', '-moose-', '-mousey-', '-no-signal-', '-nobu_oKo_jima-', '-northlondonisred', '-not-a-doctor-', '-notthesun-', '-novac-', '-nox-', '-nyx-', '-o-Y-o-Y-o-Y-o-Y', '-o-o-o', '-o-o-o-o-0-o-o-o-o-', '-oOoOoOoOoOoOoOoOo-', '-oWs-LordEnigma', '-ogre-', '-ol_l-l_lo-', '-oligodendrocyte-', '-oliver-queen-', '-onionknight-', '-oooooooh-', '-oshino_shinobu-', '-otters-', '-out', '-pANIC-', '-pH', '-packrat', '-patrizio-', '-paw-', '-pawky-', '-pinkmarshmallow-', '-pixel', '-popgoes', '-potoooooooo-', '-purdy', '-purple-is-a-fruit-', '-rabid-', '-randomwordbot-', '-really-', '-refsunpersons', '-retaliation-', '-robert-', '-rubiks', '-runswithbeer-', '-rwsr-xr-x', '-sYmbiont-', '-sackmaster-', '-saywhat123-', '-senpai', '-sgma-', '-shaddy', '-shannon-m-', '-shifty-', '-shinra-tensei-', '-shrubs-', '-sixandseven-', '-slate-', '-smokespots', '-snowcrash-', '-solus-', '-spaceborne-', '-spartacus-', '-squishi-', '-steamedhams', '-steez-', '-subtext', '-suffix-', '-supermuslim-', '-sylo-', '-taco', '-taradactyl-', '-thersites-', '-thomasjefferson-1', '-tink', '-tmwsiy-', '-tonybest', '-tuhbakee-', '-tydides', '-underdog-', '-unquote-', '-user1-', '-veiling-', '-venkman-', '-wabi-sabi-', '-wadup', '-waitingforawant-', '-webkit', '-wellplayed-', '-wethegreenpeople-', '-whitekitsune-', '-who_is_john_galt-', '-winning-', '-withallduerespect-', '-world', '-wwwpastacom', '-xTc-', '-xe', '-xenomorph-', '-xh', '-y-y-', '-yenn-', '-yogi', '-yvette-', '-zack-', '-zig-', '-zimms-', '-zombie-squirrel', '-zuck-', '0-0-0-0-0-0-', '0-90195', '0-John', '0-_1_-0', '00000000000', '00000000000000000000', '000000000000000000oo', '0000000000000001a', '0000000001000101', '0000000110111100', '000000016a', '0000217', '000040000', '0000u1', '0001000101', '0003c9fe', '000Destruct0', '000paincakes000', '0010000100111111', '00100100_00111111', '001011010110', '0011002', '0011110000110011', '001146379', '001ritinha', '001xero', '00200200', '00283466', '004forever', '007-11', '007123asd', '007King_Kong', '007SAIF', '007T', '007chill', '007ghg7', '007mrbilly', '007noon700', '0096_2251_2110_8105', '009reloaded', '00BeardedTerror', '00Boner', '00Chubby', '00DEADBEEF', '00Dan', '00Draico00', '00Glitch', '00Laser', '00Noe', '00Nothing', '00OO00', '00Seben', '00Sieg', '00TylerDurden00', '00chris00', '00cole00', '00cosgrovep', '00donnie_darko00', '00farnarkle', '00generic', '00jsd', '00mario00', '00mba', '00mpa', '00negative', '00nixon00', '00owl', '00panda', '00pseudothroaway00', '00psies', '00rayhan', '00samuels', '00spool', '00ttt00', '00ubermensch', '00uigi', '00vapour', '00wabbit', '00worms00', '00zero00', '01-559-2620', '01000100010110010100', '01001000', '01001000_01101111', '0100101010110', '0100110101101010', '010100100110111101', '010101a', '010110101001', '0102030405', '0102030405060708-9', '010a', '011000110', '0110010101101000', '01101010-0101000', '01101010011010010111', '011010110', '01110001010', '011101010', '011101010111001101', '01111000001111100000', '01111000marksthespot', '01111000x', '011111000010', '0116316', '01314150', '013cqbche', '013zen-', '01558685385', '0157h7', '0158014', '01593574562580', '016Bramble', '018118055', '01928371023974810298', '01938', '01d', '01hair', '01v6cmro', '021fluff5', '0252', '0274619937389', '027915', '02Alien', '02bluesuperroo', '02firehawk', '02m', '02pheland', '02ranger', '030503', '030927', '0311', '03114', '0311toCivDiv', '032598', '0327114', '033054', '0342narmak', '035036503530', '0376957', '03Titanium', '03fusc8', '04-', '041744', '042187', '0422', '042376x', '0454', '0473332002285', '04housemat', '0510521', '0523man', '0548', '05U', '05bagwell', '05banks', '05ekul', '0600Hours', '061071', '061ANNR', '06210311', '062b', '0651', '067324335', '06890', '06EXTN', '06Wahoo', '06Wrangler', '06gto', '06johansenad', '06koconnell', '06marchantn', '06pbmKC', '06sharpshot', '0713_', '072998', '073090', '07hogada', '07jonesj', '07nightsky', '07sev', '0807', '080997', '081503', '0818', '081890', '08230911', '082592', '085115101114', '086bagofcats', '089786', '08TangoDown08', '08livion', '08mms', '08wasGreat', '09-11-2001', '090078601', '0909a', '0909a0909', '09112001', '09128734651', '091688', '0920', '095179005', '09785475535762142', '097aceofspades', '0985alex', '09876543212345', '099992', '09Customx', '09SThr', '09jtherrien', '09twinkie', '0AWSM0', '0Boomhauer0', '0Camus0', '0DST', '0Etcetera0', '0Fab', '0Faith', '0Foxy0Engineer0', '0Fsgivin', '0JRB19690', '0JS', '0JSampson', '0KC0mputer', '0Lauren0', '0Lezz0', '0LowLight0', '0MY', '0Megabyte', '0NinjaPirate', '0Noble']

def split(arr, count):
    return [arr[i::count] for i in range(count)]
     
authorReg = 'OR'.join( "(" + 'OR'.join(" author IS '" + testAuthor + "'" for testAuthor in testAuthorsSub) + ")" for testAuthorsSub in split(testAuthors, 10))

query = """
    SELECT
      author
      , subreddit
      , count(*) as nbComment
    FROM May2015
    WHERE
       author IN (
            SELECT
                author
            FROM
                May2015
            WHERE 
                NOT ({:s})
            GROUP BY author
            HAVING count(DISTINCT subreddit)  > 6
            AND count(DISTINCT parent_id) < 3000
            LIMIT 110000)
    GROUP BY author, subreddit""".format(authorReg)

df = pd.read_sql(query, sql_conn)

df.to_csv('UtilityMatrix.csv', encoding='utf-8', index=False)